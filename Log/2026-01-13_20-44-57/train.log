2026-01-13 20:44:57,428 - INFO - 开始无监督跨模态对比学习训练
2026-01-13 20:44:57,428 - INFO - 命令行参数: {'config': '../DataLoader/config.yaml', 'epochs': 100, 'batch_size': 128, 'lr': 0.0001, 'device': 'cuda', 'gpus': '0,1,2,3', 'num_workers': 4, 'log_dir': '../Log', 'checkpoint_dir': '../Checkpoints', 'freeze_backbone': True, 'lambda_gen': 1.0}
2026-01-13 20:44:57,464 - INFO - 使用的显卡ID: [0, 1, 2, 3]
2026-01-13 20:44:57,464 - INFO - 使用设备: cuda
2026-01-13 20:44:57,464 - INFO - 创建数据加载器...
2026-01-13 20:45:01,863 - INFO - 数据加载器创建完成，训练样本数: 12311, 批次大小: 128, 批次数量: 96
2026-01-13 20:45:01,915 - INFO - 
=== Batch Size 建议 ===
2026-01-13 20:45:01,915 - INFO - 当前设置: batch_size=128, 使用显卡数=4
2026-01-13 20:45:01,915 - INFO - 注意：在multi_view_visual_encoder.py中，实际传入Backbone的图片数量会被放大为 B * N * NUM_NEIGHBOURS
2026-01-13 20:45:01,915 - INFO - 例如：如果N=4, NUM_NEIGHBOURS=5，那么每张显卡需要处理的图片数为: (16 * 4 * 5) / 4 = 80.0张
2026-01-13 20:45:01,915 - INFO - 
建议：在多卡环境下，您可以将batch size设置为 32 ~ 128
2026-01-13 20:45:01,916 - INFO - 这样每张显卡处理的实际图片数量会更合理，减少显存压力
2026-01-13 20:45:01,916 - INFO - 初始化模型...
2026-01-13 20:45:02,586 - INFO - 是否冻结ResNet Backbone: True
2026-01-13 20:45:02,586 - INFO - 检测到 4 张可用显卡，使用DataParallel...
2026-01-13 20:45:02,589 - INFO - 模型已使用DataParallel包装
2026-01-13 20:45:03,608 - INFO - 开始训练...
2026-01-13 20:45:03,608 - INFO - Epoch 1/100
2026-01-13 20:45:18,183 - ERROR - 批次处理错误 (Epoch 1, Batch 1): Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.21 GiB already allocated; 606.50 MiB free; 6.67 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2026-01-13 20:45:18,185 - ERROR - Traceback (most recent call last):
  File "train.py", line 234, in main
    outputs = image_encoder(batch, mode='train_with_gen')
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 171, in forward
    outputs = self.parallel_apply(replicas, inputs, kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 181, in parallel_apply
    return parallel_apply(replicas, inputs, kwargs, self.device_ids[:len(replicas)])
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 89, in parallel_apply
    output.reraise()
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/_utils.py", line 543, in reraise
    raise exception
torch.cuda.OutOfMemoryError: Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.21 GiB already allocated; 606.50 MiB free; 6.67 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF


2026-01-13 20:45:19,410 - ERROR - 批次处理错误 (Epoch 1, Batch 2): Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.20 GiB already allocated; 1.14 GiB free; 6.12 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2026-01-13 20:45:19,411 - ERROR - Traceback (most recent call last):
  File "train.py", line 234, in main
    outputs = image_encoder(batch, mode='train_with_gen')
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 171, in forward
    outputs = self.parallel_apply(replicas, inputs, kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 181, in parallel_apply
    return parallel_apply(replicas, inputs, kwargs, self.device_ids[:len(replicas)])
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 89, in parallel_apply
    output.reraise()
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/_utils.py", line 543, in reraise
    raise exception
torch.cuda.OutOfMemoryError: Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.20 GiB already allocated; 1.14 GiB free; 6.12 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF


2026-01-13 20:45:20,919 - ERROR - 批次处理错误 (Epoch 1, Batch 3): Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.20 GiB already allocated; 1.50 GiB free; 5.76 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2026-01-13 20:45:20,919 - ERROR - Traceback (most recent call last):
  File "train.py", line 234, in main
    outputs = image_encoder(batch, mode='train_with_gen')
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 171, in forward
    outputs = self.parallel_apply(replicas, inputs, kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 181, in parallel_apply
    return parallel_apply(replicas, inputs, kwargs, self.device_ids[:len(replicas)])
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 89, in parallel_apply
    output.reraise()
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/_utils.py", line 543, in reraise
    raise exception
torch.cuda.OutOfMemoryError: Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.20 GiB already allocated; 1.50 GiB free; 5.76 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF


2026-01-13 20:45:22,073 - ERROR - 批次处理错误 (Epoch 1, Batch 4): Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.20 GiB already allocated; 1.50 GiB free; 5.76 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2026-01-13 20:45:22,074 - ERROR - Traceback (most recent call last):
  File "train.py", line 234, in main
    outputs = image_encoder(batch, mode='train_with_gen')
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 171, in forward
    outputs = self.parallel_apply(replicas, inputs, kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/data_parallel.py", line 181, in parallel_apply
    return parallel_apply(replicas, inputs, kwargs, self.device_ids[:len(replicas)])
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 89, in parallel_apply
    output.reraise()
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/_utils.py", line 543, in reraise
    raise exception
torch.cuda.OutOfMemoryError: Caught OutOfMemoryError in replica 3 on device 3.
Original Traceback (most recent call last):
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/data1/Wuzhihe/Neighbour_Images/Models/multi_view_visual_encoder.py", line 197, in forward
    backbone_feats = self.backbone(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torchvision/models/resnet.py", line 158, in forward
    identity = self.downsample(x)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/container.py", line 204, in forward
    input = module(input)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 171, in forward
    return F.batch_norm(
  File "/home/hdu/.conda/envs/Viewclouds/lib/python3.8/site-packages/torch/nn/functional.py", line 2450, in batch_norm
    return torch.batch_norm(
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 1.91 GiB (GPU 3; 10.75 GiB total capacity; 5.20 GiB already allocated; 1.50 GiB free; 5.76 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF


